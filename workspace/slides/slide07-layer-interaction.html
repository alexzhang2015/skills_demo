<!DOCTYPE html>
<html>
<head>
<style>
html { background: #0A1628; }
body {
  width: 720pt; height: 405pt; margin: 0; padding: 0;
  font-family: Arial, sans-serif;
  display: flex; flex-direction: column;
  background-image: url('../assets/bg-dark.png');
  background-size: cover;
}
.header { padding: 12pt 40pt 6pt 40pt; }
.header-title { color: #00D4FF; font-size: 20pt; font-weight: bold; margin: 0; }
.main { flex: 1; display: flex; padding: 5pt 40pt 36pt 40pt; gap: 12pt; }
.diagram { flex: 1; display: flex; flex-direction: column; gap: 5pt; }
.flow-row { display: flex; align-items: center; gap: 5pt; }
.layer-block { width: 75pt; padding: 5pt; border-radius: 4pt; text-align: center; }
.lb-master { background: rgba(139, 92, 246, 0.3); border: 1pt solid #8B5CF6; }
.lb-sub { background: rgba(0, 212, 255, 0.2); border: 1pt solid #00D4FF; }
.lb-workflow { background: rgba(245, 158, 11, 0.2); border: 1pt solid #F59E0B; }
.lb-skills { background: rgba(124, 58, 237, 0.2); border: 1pt solid #7C3AED; }
.lb-mcp { background: rgba(14, 165, 233, 0.2); border: 1pt solid #0EA5E9; }
.lb-text { color: #FFFFFF; font-size: 7pt; font-weight: bold; margin: 0; }
.arrow-h { color: #5A7A9A; font-size: 10pt; margin: 0; }
.msg-box { flex: 1; background: rgba(30, 58, 95, 0.5); border-radius: 3pt; padding: 4pt 6pt; }
.msg-text { color: #B8C9DC; font-size: 7pt; margin: 0; }
.sidebar { width: 160pt; display: flex; flex-direction: column; gap: 6pt; }
.mechanism { background: rgba(30, 58, 95, 0.7); border-radius: 5pt; padding: 8pt; border-left: 3pt solid #00D4FF; }
.mech-title { color: #00D4FF; font-size: 9pt; font-weight: bold; margin: 0 0 4pt 0; }
.mech-item { color: #B8C9DC; font-size: 7pt; margin: 0 0 2pt 0; }
</style>
</head>
<body>
<div class="header">
  <h1 class="header-title">四层架构 v2.0 协作流程</h1>
</div>
<div class="main">
  <div class="diagram">
    <div class="flow-row">
      <div class="layer-block lb-master"><p class="lb-text">Master Agent</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">1. 接收自然语言，意图识别</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-master"><p class="lb-text">任务分解</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-master"><p class="lb-text">Master Agent</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">2. 分发任务到子场景Agent</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-sub"><p class="lb-text">子场景Agent</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-sub"><p class="lb-text">子场景Agent</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">3. 生成Workflow执行计划</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-workflow"><p class="lb-text">Workflow编排</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-workflow"><p class="lb-text">Workflow编排</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">4. 调度Skills执行（串行/并行）</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-skills"><p class="lb-text">Skills执行</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-skills"><p class="lb-text">Skills执行</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">5. 调用MCP Tools原子能力</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-mcp"><p class="lb-text">MCP Tools</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-mcp"><p class="lb-text">MCP Tools</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">6. 返回执行结果</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-skills"><p class="lb-text">Skills执行</p></div>
    </div>
    <div class="flow-row">
      <div class="layer-block lb-skills"><p class="lb-text">Skills执行</p></div>
      <p class="arrow-h">→</p>
      <div class="msg-box"><p class="msg-text">7. 汇总结果，状态回传</p></div>
      <p class="arrow-h">→</p>
      <div class="layer-block lb-master"><p class="lb-text">Master Agent</p></div>
    </div>
  </div>
  <div class="sidebar">
    <div class="mechanism">
      <h3 class="mech-title">异步消息队列</h3>
      <p class="mech-item">层间解耦</p>
      <p class="mech-item">支持高并发</p>
    </div>
    <div class="mechanism" style="border-left-color:#F59E0B;">
      <h3 class="mech-title" style="color:#F59E0B;">状态回传机制</h3>
      <p class="mech-item">实时进度追踪</p>
      <p class="mech-item">断点续传</p>
    </div>
    <div class="mechanism" style="border-left-color:#10B981;">
      <h3 class="mech-title" style="color:#10B981;">错误处理</h3>
      <p class="mech-item">指数退避重试</p>
      <p class="mech-item">熔断保护</p>
    </div>
    <div class="mechanism" style="border-left-color:#8B5CF6;">
      <h3 class="mech-title" style="color:#8B5CF6;">人工审批</h3>
      <p class="mech-item">关键节点拦截</p>
      <p class="mech-item">审批流集成</p>
    </div>
  </div>
</div>
</body>
</html>
